<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="icon" href="{{ url_for('static', filename='images/PFPs/Bot_PFP.png') }}" type="image/png">
    <title>{% block title %}ScottGPT{% endblock %}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    {% block css %}{% endblock %}
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Sans&family=Oswald:wght@200..700&display=swap"
      rel="stylesheet"
    />

    {% block head %}{% endblock %}
  </head>

  <body
    {% if conversation_id %}data-conversation-id="{{ conversation_id }}"{% endif %}
    {% if course_id %}data-course-id="{{ course_id }}"{% endif %}
    {% if conversation_state %}data-conversation-state="{{ conversation_state }}"{% endif %}
  >
    <header>
      <h1>Scott<span><b>GPT</b></span></h1>
      <img src="{{ url_for('static', filename='images/UC_Riverside_Horiz_BluBG.png') }}" alt="UCR Logo" class="ucr-logo">
    </header>


    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
          <ul class="flashes">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}
    {% endwith %}


    {% block body %}{% endblock %}

    <div>
      <a href="{{ url_for('web_interface.authentication_routes.logout') }}" class="logout-button">Logout</a>
    </div>
    {% block scripts %}{% endblock %}

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const deleteLinks = document.querySelectorAll('.delete-link');        
        deleteLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();

                if (confirm('Are you sure you want to delete this item?')) {
                    const url = this.getAttribute('href');

                    fetch(url, {
                        method: 'DELETE',
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error('Deletion failed.');
                    })
                    .then(data => {
                        if (data.redirect_url) {
                            window.location.href = data.redirect_url;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred: ' + error.message);
                    });
                }
            });
        });
      });
    </script>
  </body>
</html>
